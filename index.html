<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milestone Watch Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #050505; }
        .glow-nba { text-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
        .glow-nhl { text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .player-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .player-card:hover { transform: translateY(-10px); border-color: rgba(255,255,255,0.2); }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-16">
            <div class="flex flex-wrap justify-center gap-4 mb-10">
                <button onclick="switchLeague('nba')" class="px-10 py-3 rounded-2xl border-2 border-orange-600/30 font-black hover:border-orange-500 transition-all focus:outline-none focus:ring-2 focus:ring-orange-500">üèÄ NBA</button>
                <button onclick="switchLeague('nhl')" class="px-10 py-3 rounded-2xl border-2 border-blue-600/30 font-black hover:border-blue-500 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500">üèí NHL</button>
            </div>
            <h1 id="title" class="text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all duration-500">MILESTONE WATCH</h1>
            <p id="sub-title" class="text-zinc-500 text-xl mt-4">Select a league to track history in the making.</p>
        </header>

        <div id="player-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
        
        <div id="state-container" class="flex flex-col items-center justify-center py-32 text-zinc-700">
            <div id="loading-spinner" class="hidden mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin"></div>
            <p id="state-text" class="text-2xl font-bold tracking-tight">Select a league to begin</p>
        </div>
    </div>

    <script>
        async function switchLeague(league) {
            const grid = document.getElementById('player-grid');
            const stateText = document.getElementById('state-text');
            const spinner = document.getElementById('loading-spinner');
            const title = document.getElementById('title');
            
            grid.innerHTML = '';
            spinner.classList.remove('hidden');
            stateText.innerText = "Accessing league data...";
            
            // Toggle Title Styling
            if (league === 'nba') {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all";
                title.innerText = "HOOP TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin";
            } else {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nhl italic text-blue-500 uppercase transition-all";
                title.innerText = "PUCK TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-blue-500 rounded-full animate-spin";
            }

            try {
                // This fetches the files generated by your Python scripts
                // Added ?v=${Date.now()} to bust browser cache and force load fresh data
                const res = await fetch(`${league}_milestones.json?v=${Date.now()}`);
                if (!res.ok) throw new Error("Data not found");
                
                let players = await res.json();

                // SORTING LOGIC: Sort by 'needed' (ascending)
                players.sort((a, b) => a.needed - b.needed);

                spinner.classList.add('hidden');
                stateText.innerText = players.length === 0 ? "No active milestones detected." : "";
                
                players.forEach(p => {
                    const card = document.createElement('div');
                    card.className = "player-card bg-zinc-900/40 rounded-[2.5rem] p-8 border border-white/5 flex flex-col items-center text-center backdrop-blur-md";
                    
                    const accent = league === 'nba' ? 'text-orange-500' : 'text-blue-500';
                    const urgency = p.needed <= 15 ? 'text-red-500 animate-pulse' : accent;

                    // Fallback logic for images
                    // If the main image fails, we try the legacy BAMGrid URL for NHL, then the placeholder
                    const fallbackChain = league === 'nhl' 
                        ? `this.onerror=null; this.src='https://cms.nhl.bamgrid.com/images/headshots/current/168x168/${p.player_id}.jpg'; this.onerror=function(){this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'}`
                        : `this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'`;

                    card.innerHTML = `
                        <div class="relative mb-6">
                            <img src="${p.image_url}" 
                                 onerror="${fallbackChain}" 
                                 class="w-40 h-40 object-cover rounded-full border-4 border-white/10 bg-zinc-800 shadow-2xl">
                        </div>
                        <h2 class="text-3xl font-black mb-1 tracking-tight leading-tight">${p.player_name}</h2>
                        <div class="px-4 py-1 rounded-full text-[10px] font-black text-zinc-500 tracking-widest uppercase mb-6 bg-white/5 border border-white/5">${p.team}</div>
                        <div class="grid grid-cols-2 gap-4 w-full mb-8">
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Current</p><p class="text-xl font-bold">${p.current_stat.toLocaleString()}</p></div>
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Target</p><p class="text-xl font-bold">${p.target_milestone.toLocaleString()}</p></div>
                        </div>
                        <p class="text-[10px] text-zinc-400 font-black uppercase tracking-widest mb-1">Remaining</p>
                        <p class="text-7xl font-black ${urgency} tracking-tighter">${p.needed}</p>
                    `;
                    grid.appendChild(card);
                });
            } catch (e) {
                spinner.classList.add('hidden');
                stateText.innerHTML = `
                    <div class="text-center">
                        <div class="mb-2">Data file not found.</div>
                        <div class="text-sm font-normal text-zinc-500">Run the python script: <br><code>python scan_${league}_milestones.json.py</code></div>
                    </div>
                `;
            }
        }

        // Auto-load NBA on start
        window.onload = () => switchLeague('nba');
    </script>
</body>
</html>